this.b3=this.b3||{},function(){"use strict";b3.VERSION="0.2.0",b3.SUCCESS=1,b3.FAILURE=2,b3.RUNNING=3,b3.ERROR=4,b3.COMPOSITE="composite",b3.DECORATOR="decorator",b3.ACTION="action",b3.CONDITION="condition"}();
!function(){"use strict";b3.createUUID=function(){for(var t=[],o="0123456789abcdef",r=0;36>r;r++)t[r]=o.substr(Math.floor(16*Math.random()),1);t[14]="4",t[19]=o.substr(3&t[19]|8,1),t[8]=t[13]=t[18]=t[23]="-";var i=t.join("");return i},b3.Class=function(t,o){var r=function(t){this.initialize(t||{})};if(t&&(r.prototype=Object.create(t.prototype),r.prototype.constructor=r),r.prototype.initialize||(r.prototype.initialize=function(){}),o)for(var i in o)r.prototype[i]=o[i];return r}}();
!function(){"use strict";b3.BehaviorTree=b3.Class(null,{id:null,title:null,description:null,properties:null,root:null,debug:null,initialize:function(){this.id=b3.createUUID(),this.title="The behavior tree",this.description="Default description",this.properties={},this.root=null,this.debug=null},load:function(e,t){t=t||{},this.title=e.title||this.title,this.description=e.description||this.description,this.properties=e.properties||this.properties;var i,r,o,n={};for(i in e.nodes){r=e.nodes[i];var s;if(r.name in t)s=t[r.name];else{if(!(r.name in b3))throw new EvalError('BehaviorTree.load: Invalid node name + "'+r.name+'".');s=b3[r.name]}o=new s(r.properties),o.id=r.id||o.id,o.title=r.title||o.title,o.description=r.description||o.description,o.properties=r.properties||o.properties,n[i]=o}for(i in e.nodes)if(r=e.nodes[i],o=n[i],o.category===b3.COMPOSITE&&r.children)for(var l=0;l<r.children.length;l++){var d=r.children[l];o.children.push(n[d])}else o.category===b3.DECORATOR&&r.child&&(o.child=n[r.child]);this.root=n[e.root]},dump:function(){var e={},t=[];if(e.title=this.title,e.description=this.description,e.root=this.root?this.root.id:null,e.properties=this.properties,e.nodes={},e.custom_nodes=[],!this.root)return e;for(var i=[this.root];i.length>0;){var r=i.pop(),o={};o.id=r.id,o.name=r.name,o.title=r.title,o.description=r.description,o.properties=r.properties,o.parameters=r.parameters;var n=r.constructor&&r.constructor.prototype,s=n&&n.name||r.name;if(!b3[s]&&t.indexOf(s)<0){var l={};l.name=s,l.title=n&&n.title||r.title,l.category=r.category,t.push(s),e.custom_nodes.push(l)}if(r.category===b3.COMPOSITE&&r.children){for(var d=[],h=r.children.length-1;h>=0;h--)d.push(r.children[h].id),i.push(r.children[h]);o.children=d}else r.category===b3.DECORATOR&&r.child&&(i.push(r.child),o.child=r.child.id);e.nodes[r.id]=o}return e},tick:function(e,t){if(!t)throw"The blackboard parameter is obligatory and must be an instance of b3.Blackboard";var i=new b3.Tick;i.debug=this.debug,i.target=e,i.blackboard=t,i.tree=this;var r,o=this.root._execute(i),n=t.get("openNodes",this.id),s=i._openNodes.slice(0),l=0;for(r=0;r<Math.min(n.length,s.length)&&(l=r+1,n[r]===s[r]);r++);for(r=n.length-1;r>=l;r--)n[r]._close(i);return t.set("openNodes",s,this.id),t.set("nodeCount",i._nodeCount,this.id),o}})}();
!function(){"use strict";b3.Tick=b3.Class(null,{tree:null,debug:null,target:null,blackboard:null,_openNodes:[],_nodeCount:0,initialize:function(){this.tree=null,this.debug=null,this.target=null,this.blackboard=null,this._openNodes=[],this._nodeCount=0},_enterNode:function(n){this._nodeCount++,this._openNodes.push(n)},_openNode:function(n){},_tickNode:function(n){},_closeNode:function(n){this._openNodes.pop()},_exitNode:function(n){}})}();
!function(){"use strict";b3.Blackboard=b3.Class(null,{initialize:function(){this._baseMemory={},this._treeMemory={}},_getTreeMemory:function(e){return this._treeMemory[e]||(this._treeMemory[e]={nodeMemory:{},openNodes:[],traversalDepth:0,traversalCycle:0}),this._treeMemory[e]},_getNodeMemory:function(e,t){var r=e.nodeMemory;return r[t]||(r[t]={}),r[t]},_getMemory:function(e,t){var r=this._baseMemory;return e&&(r=this._getTreeMemory(e),t&&(r=this._getNodeMemory(r,t))),r},set:function(e,t,r,o){var n=this._getMemory(r,o);n[e]=t},get:function(e,t,r){var o=this._getMemory(t,r);return o[e]}})}();
!function(){"use strict";b3.BaseNode=b3.Class(null,{id:null,name:null,category:null,title:null,description:null,parameters:null,properties:null,initialize:function(t){this.id=b3.createUUID(),this.title=this.title||this.name,this.description="",this.parameters={},this.properties={}},_execute:function(t){this._enter(t),t.blackboard.get("isOpen",t.tree.id,this.id)||this._open(t);var i=this._tick(t);return i!==b3.RUNNING&&this._close(t),this._exit(t),i},_enter:function(t){t._enterNode(this),this.enter(t)},_open:function(t){t._openNode(this),t.blackboard.set("isOpen",!0,t.tree.id,this.id),this.open(t)},_tick:function(t){return t._tickNode(this),this.tick(t)},_close:function(t){t._closeNode(this),t.blackboard.set("isOpen",!1,t.tree.id,this.id),this.close(t)},_exit:function(t){t._exitNode(this),this.exit(t)},enter:function(t){},open:function(t){},tick:function(t){},close:function(t){},exit:function(t){}})}();
!function(){"use strict";b3.Action=b3.Class(b3.BaseNode,{category:b3.ACTION,initialize:function(i){b3.BaseNode.prototype.initialize.call(this)}})}();
!function(){"use strict";b3.Composite=b3.Class(b3.BaseNode,{category:b3.COMPOSITE,initialize:function(i){b3.BaseNode.prototype.initialize.call(this),this.children=(i.children||[]).slice(0)}})}();
!function(){"use strict";b3.Condition=b3.Class(b3.BaseNode,{category:b3.CONDITION,initialize:function(i){b3.BaseNode.prototype.initialize.call(this)}})}();
!function(){"use strict";b3.Decorator=b3.Class(b3.BaseNode,{category:b3.DECORATOR,initialize:function(i){b3.BaseNode.prototype.initialize.call(this),this.child=i.child||null}})}();
!function(){"use strict";b3.Priority=b3.Class(b3.Composite,{name:"Priority",tick:function(i){for(var r=0;r<this.children.length;r++){var t=this.children[r]._execute(i);if(t!==b3.FAILURE)return t}return b3.FAILURE}})}();
!function(){"use strict";b3.Sequence=b3.Class(b3.Composite,{name:"Sequence",tick:function(e){for(var n=0;n<this.children.length;n++){var t=this.children[n]._execute(e);if(t!==b3.SUCCESS)return t}return b3.SUCCESS}})}();
!function(){"use strict";b3.Inverter=b3.Class(b3.Decorator,{name:"Inverter",tick:function(t){if(!this.child)return b3.ERROR;var e=this.child._execute(t);return e==b3.SUCCESS?e=b3.FAILURE:e==b3.FAILURE&&(e=b3.SUCCESS),e}})}();
!function(){"use strict";b3.Limiter=b3.Class(b3.Decorator,{name:"Limiter",title:"Limit <maxLoop> Activations",parameters:{maxLoop:1},initialize:function(i){if(b3.Decorator.prototype.initialize.call(this,i),!i.maxLoop)throw"maxLoop parameter in Limiter decorator is an obligatory parameter";this.maxLoop=i.maxLoop},open:function(i){i.blackboard.set("i",0,i.tree.id,this.id)},tick:function(i){if(!this.child)return b3.ERROR;var t=i.blackboard.get("i",i.tree.id,this.id);if(t<this.maxLoop){var e=this.child._execute(i);return(e==b3.SUCCESS||e==b3.FAILURE)&&i.blackboard.set("i",t+1,i.tree.id,this.id),e}return b3.FAILURE}})}();
!function(){"use strict";b3.MaxTime=b3.Class(b3.Decorator,{name:"MaxTime",title:"Max <maxTime>ms",parameters:{maxTime:0},initialize:function(e){if(b3.Decorator.prototype.initialize.call(this,e),!e.maxTime)throw"maxTime parameter in MaxTime decorator is an obligatory parameter";this.maxTime=e.maxTime},open:function(e){var i=(new Date).getTime();e.blackboard.set("startTime",i,e.tree.id,this.id)},tick:function(e){if(!this.child)return b3.ERROR;var i=(new Date).getTime(),t=e.blackboard.get("startTime",e.tree.id,this.id),a=this.child._execute(e);return i-t>this.maxTime?b3.FAILURE:a}})}();
!function(){"use strict";b3.Repeater=b3.Class(b3.Decorator,{name:"Repeater",title:"Repeat <maxLoop>x",parameters:{maxLoop:-1},initialize:function(t){b3.Decorator.prototype.initialize.call(this,t),this.maxLoop=t.maxLoop||-1},open:function(t){t.blackboard.set("i",0,t.tree.id,this.id)},tick:function(t){if(!this.child)return b3.ERROR;for(var i=t.blackboard.get("i",t.tree.id,this.id),e=b3.SUCCESS;(this.maxLoop<0||i<this.maxLoop)&&(e=this.child._execute(t),e==b3.SUCCESS||e==b3.FAILURE);)i++;return t.blackboard.set("i",i,t.tree.id,this.id),e}})}();
!function(){"use strict";b3.RepeatUntilFailure=b3.Class(b3.Decorator,{name:"RepeatUntilFailure",title:"Repeat Until Failure",parameters:{maxLoop:-1},initialize:function(i){b3.Decorator.prototype.initialize.call(this,i),this.maxLoop=i.maxLoop||-1},open:function(i){i.blackboard.set("i",0,i.tree.id,this.id)},tick:function(i){if(!this.child)return b3.ERROR;for(var t=i.blackboard.get("i",i.tree.id,this.id),e=b3.ERROR;(this.maxLoop<0||t<this.maxLoop)&&(e=this.child._execute(i),e==b3.SUCCESS);)t++;return t=i.blackboard.set("i",t,i.tree.id,this.id),e}})}();
!function(){"use strict";b3.RepeatUntilSuccess=b3.Class(b3.Decorator,{name:"RepeatUntilSuccess",title:"Repeat Until Success",parameters:{maxLoop:-1},initialize:function(t){b3.Decorator.prototype.initialize.call(this,t),this.maxLoop=t.maxLoop||-1},open:function(t){t.blackboard.set("i",0,t.tree.id,this.id)},tick:function(t){if(!this.child)return b3.ERROR;for(var i=t.blackboard.get("i",t.tree.id,this.id),e=b3.ERROR;(this.maxLoop<0||i<this.maxLoop)&&(e=this.child._execute(t),e==b3.FAILURE);)i++;return i=t.blackboard.set("i",i,t.tree.id,this.id),e}})}();
!function(){"use strict";b3.Error=b3.Class(b3.Action,{name:"Error",tick:function(r){return b3.ERROR}})}();
!function(){"use strict";b3.Failer=b3.Class(b3.Action,{name:"Failer",tick:function(i){return b3.FAILURE}})}();
!function(){"use strict";b3.Runner=b3.Class(b3.Action,{name:"Runner",tick:function(n){return b3.RUNNING}})}();
!function(){"use strict";b3.Succeeder=b3.Class(b3.Action,{name:"Succeeder",tick:function(c){return b3.SUCCESS}})}();
!function(){"use strict";b3.Wait=b3.Class(b3.Action,{name:"Wait",title:"Wait <milliseconds>ms",parameters:{milliseconds:0},initialize:function(i){i=i||{},b3.Action.prototype.initialize.call(this),this.endTime=i.milliseconds||0},open:function(i){var t=(new Date).getTime();i.blackboard.set("startTime",t,i.tree.id,this.id)},tick:function(i){var t=(new Date).getTime(),e=i.blackboard.get("startTime",i.tree.id,this.id);return t-e>this.endTime?b3.SUCCESS:b3.RUNNING}})}();